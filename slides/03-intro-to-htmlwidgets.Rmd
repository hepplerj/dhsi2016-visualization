---
title       : "Introduction to htmlwidgets"
author      : Jason A. Heppler
maketitle: true
output:
  rmdshower::shower_presentation:
    self_contained: false
    katex: true
    theme: material
---

## htmlwidgets

An R package for integrating JavaScript libraries into R visualizations. Visualizations can appear in RMarkdown documents, RStudio, or Shiny web applications (more on this on Day 4).

You can find the full documentation for `htmlwidgets` at <http://www.htmlwidgets.org>.

## htmlwidgets - Installation

```{r, eval=FALSE}
# from CRAN
install.packages("htmlwidgets")
# or the development version
devtools::install_github("ramnathv/htmlwidgets")

library(htmlwidgets)
```

## Specific Widgets

You don't need the entire `htmlwidgets` package. We can call upon specific packages:

```{r, eval=FALSE}
# time series charts
devtools::install_github("rstudio/dygraphs")

# data tables
devtools::install_github("rstudio/DT")

# leaflet maps
devtools::install_github("rstudio/leaflet")
```

## Data Tables

```{r}
library(historydata)
data("early_colleges")

library(DT)
```

## DataTables

```{r, message = F, warning = F}
library(DT)
datatable(early_colleges)
```

## dygraphs

Let's take a look at some weather data for San Francisco.

```{r}
library(readr)
library(stringr)
library(dplyr)
library(lubridate)
weather.df <- read_csv("http://bl.ocks.org/bricedev/raw/458a01917183d98dff3c/sf.csv")

# We'll make the variable names easier to work with
names(weather.df) <- names(weather.df) %>% 
  str_to_lower() %>% 
  str_replace("\\s+", "_")

weather.keeps <- c("date", "max_temperaturec", "min_temperaturec")
weather.df <- weather.df[weather.keeps]
```

## dygraphs

```{r}
weather.df
```

## dygraphs

Since we have consistent time-series information in the climate data, we can visualize this easily enough as a line chart. Recall a method for building this chart with `ggplot`:

```{r, eval=FALSE}
library(ggplot2)
library(RColorBrewer)
ggplot() +
  geom_line(data = weather.df, 
            aes(x = date, y = min_temperaturec), 
            color = RColorBrewer::brewer.pal(3, "Set1")[2]) +
  geom_line(data = weather.df, 
            aes(x = date, y = max_temperaturec), 
            color = RColorBrewer::brewer.pal(3, "Set1")[1]) +
  labs(title = "San Francisco Weather Trends, 2014",
       x = "Date",
       y = "Minimum and Maxium Temperature (C)")
```

## {.fullscreen}

```{r, echo=FALSE}
library(ggplot2)
library(RColorBrewer)
ggplot() +
  geom_line(data = weather.df, aes(x = date, y = min_temperaturec), color = RColorBrewer::brewer.pal(3, "Set1")[2]) +
  geom_line(data = weather.df, aes(x = date, y = max_temperaturec), color = RColorBrewer::brewer.pal(3, "Set1")[1]) +
  labs(title = "San Francisco Weather Trends, 2014",
       x = "Date",
       y = "Minimum and Maxium Temperature (C)")
```

## dygraphs

But let's say you wanted more details about the weather for particular days. By making the chart interactive to our mouse events, we can explore the data in the visualization more deeply.

```{r, eval=FALSE}
library(dygraphs)
library(xts)

# We need to do some conversion of date information
# into a timeseries object
# <https://cran.rstudio.com/web/packages/xts/index.html>
weather.sf <- xts(weather.df[,-1], order.by=weather.df$date)
index(weather.sf) <- index(weather.sf)-0

dygraph(weather.sf, main = "San Francisco Temperatures") %>%
  dySeries("min_temperaturec", label = "Min. Temp. (C)") %>%
  dySeries("max_temperaturec", label = "Max. Temp. (C)") %>%
  dyOptions(colors = RColorBrewer::brewer.pal(3, "Paired")) %>%
  dyLegend(width = 400)
```

## {.fullscreen}

```{r, echo=FALSE, eval=TRUE}
dygraph(weather.sf, main = "San Francisco Temperatures") %>%
  dySeries("min_temperaturec", label = "Min. Temp. (C)") %>%
  dySeries("max_temperaturec", label = "Max. Temp. (C)") %>%
  dyOptions(colors = RColorBrewer::brewer.pal(3, "Paired")) %>%
  dyLegend(width = 400)
```

## dygraphs

We can also add a range selector that allows us to examine time series data more closely within constrained bounds of time by passing the `dyRangeSelector()` function.

```{r}
dygraph(weather.sf, main = "San Francisco Temperatures") %>%
  dySeries("min_temperaturec", label = "Min. Temp. (C)") %>%
  dySeries("max_temperaturec", label = "Max. Temp. (C)") %>%
  dyOptions(colors = RColorBrewer::brewer.pal(3, "Paired")) %>%
  dyLegend(width = 400) %>%
  dyRangeSelector()
```

## Plotly

You'll recall the chart we made on Day 1 of confessions and converts using `ggplot`.

```{r, eval=FALSE}
ggplot(paulist_missions, aes(x = confessions, y = converts)) +
  geom_point(alpha = 0.5, shape = 1) +
  labs(title = "Paulist Missions",
       x = "Confessions",
       y = "Converts") 
```

## {.fullscreen}

```{r, echo=FALSE}
ggplot(paulist_missions, aes(x = confessions, y = converts)) +
  geom_point(alpha = 0.5, shape = 1) +
  labs(title = "Paulist Missions",
       x = "Confessions",
       y = "Converts") 
```

## Plotly

```{r}
library(plotly)
plot_ly(paulist_missions, 
        x = confessions, y = converts, 
        mode = "markers", text = paste("Converts: ", converts))
```

## Interactive Network Visualization

htmlwidgets comes with a few options

- networkD3: using the `D3.js` JavaScript library
- visNetwork: using the `vis.js` JavaScript library

## networkD3

```{r}
library(networkD3)
data(MisLinks, MisNodes)
forceNetwork(Links = MisLinks, Nodes = MisNodes, Source = "source",
             Target = "target", NodeID = "name",
             Group = "group", opacity = 0.8)
```

## visNetwork

Be aware of an idiosyncrasy with `visNetwork`, which requires:

- a nodes data.frame, with an `id` column
- a edges data.frame, with `from` and `to` columns, which make the link with `id`

Not the conventional `source` - `target` table we often set up for network analysis.

## visNetwork - Setup

```{r}
MisLinks %>% head(5)
MisNodes %>% head(5)

mis_nodes <- MisNodes
mis_links <- MisLinks
```

## visNetwork - Setup

```{r}
library(plyr)
mis_nodes$id <- seq.int(nrow(MisNodes))
mis_links <- rename(mis_links, c("source"="from", "target"="to"))
mis_nodes <- rename(mis_nodes, c("name"="label"))
```

## visNetwork

```{r}
visNetwork(mis_nodes, mis_links) %>% visInteraction(dragNodes = FALSE, 
                                            hideEdgesOnDrag = TRUE, 
                                            hover = TRUE) %>%
  visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE)
```
